<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ìƒíšŒ ì…ì°° ì•Œë¦¼</title>
</head>
<body>
<div th:fragment="notify">
    <!--<h4>ğŸ”” ì‹¤ì‹œê°„ ì•Œë¦¼</h4>
    <ul id="notification-list"></ul>-->
    <script src="/webjars/sockjs-client/1.5.1/sockjs.min.js"></script>
    <script src="/webjars/stomp-websocket/2.3.4/stomp.min.js"></script>
    <script th:inline="javascript">
        const socket = new SockJS("/ws-notify");
        const stompClient = Stomp.over(socket);

        const userId = [[${session.userId}]]; // ë¡œê·¸ì¸ëœ ì‚¬ìš©ì ID
        stompClient.connect({}, function() {
            console.log("stomp ì—°ê²° ì„±ê³µ")
            stompClient.subscribe("/topic/notify/" + userId, function(notification) {
                // ì•Œë¦¼ í‘œì‹œ
                console.log("ì½˜ì†”: "+notification.body)
                alert("ì•Œë¦¼" + notification.body);
                location.reload(true);
            });
        }, function(error) {
            console.log("stomp ì—°ê²°ì‹¤íŒ¨")
        })

        window.addEventListener("beforeunload", () => {
            if (stompClient && stompClient.connected) {
                stompClient.disconnect(() => console.log("WebSocket disconnected."));
            }
        });
    </script>
</div>
</body>
</html>